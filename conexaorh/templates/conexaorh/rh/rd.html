{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="https://encrypted-tbn2.gstatic.com/faviconV2?url=https://www.nortetech.net&client=VFE&size=64&type=FAVICON&fallback_opts=TYPE,SIZE,URL&nfrp=2" type="image/png">
  <title>{% block title %}RH/DP{% endblock %}</title>

  <!-- Bootstrap & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <!-- jQuery + Select2 JS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <link rel="stylesheet" href="{% static 'conexaorh/css/rh.css' %}">
</head>
<body>
       <h2>Requisição de Desligamento para Aprovação</h2>
    <table border="1">
        <tr>
            <th>Requisitante</th>
            <th>Colaborador a ser Desligado</th>
            <th>Função</th>
            <th>Data de Solicitação</th>
            <th>Assinatura Diretor</th>
            <th>Data Assinatura Diretor</th>
            <th>Assinatura Presidente</th>
            <th>Data Assinatura Presidente</th>
            <th>Assinatura RH</th>
            <th>Data Assinatura RH</th>
            <th>Tempo para Autorização (dias)</th>
            <th>Download Excel</th>
        </tr>
        {% for registro in registros %}
        <tr>
            <td>{{ registro.requisitante }}</td>
            <td>{{ registro.colaborador_desligado }}</td>
            <td>{{ registro.funcao }}</td>
            <td>{{ registro.data_solicitacao|date:"d/m/Y H:i" }}</td>
            <td>    
                {% if registro.assinatura_diretor %}
                    <img src="{{ registro.assinatura_diretor.url }}" alt="Assinatura Diretor" style="height: 100px;">
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                {% if registro.assinatura_diretor %}
                    {{ registro.data_autorizacao_diretor|date:"d/m/Y H:i" }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>    
                {% if registro.assinatura_presidente %}
                    <img src="{{ registro.assinatura_presidente.url }}" alt="Assinatura Presidente" style="height: 100px;">
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                {% if registro.assinatura_presidente %}
                    {{ registro.data_autorizacao_presidente|date:"d/m/Y H:i" }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                {% if registro.assinatura_rh %}
                    <p>Aprovado pelo RH:</p>
                    <img src="{{ registro.assinatura_rh.url }}" alt="Assinatura RH" style="height: 100px;">
                {% else %}
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <input type="hidden" name="registro_id" value="{{ registro.id }}">
                        <input type="hidden" name="tipo_registro" value="rd">
                        <button type="submit">Aprovar com Assinatura</button>
                    </form>
                {% endif %}
            </td>
            <td>
                {% if registro.assinatura_rh  %}
                    {{ registro.data_autorizacao_rh|date:"d/m/Y H:i" }}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                {% if registro.dias_para_autorizacao_rh is not None %}
                    {% if registro.dias_para_autorizacao_rh == 0 %}
                        Aprovado no mesmo dia
                    {% else %}
                        {{ registro.dias_para_autorizacao_rh }} dias
                    {% endif %}
                {% else %}
                    -
                {% endif %}
            </td>
            <td>
                <a href="{% url 'download_rd_excel' registro.id %}">
                    <button>Baixar Excel</button>
                </a>
            </td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>